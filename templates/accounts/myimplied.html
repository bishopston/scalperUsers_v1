{%  extends "../base/base.html" %}
{% block content %}

{% load index %}

<style>
    td {
       white-space: nowrap;
    }
 </style>

    <nav aria-label="breadcrumb">
        <div class="container">
            <ol class="breadcrumb">
            <li class="breadcrumb-item active" aria-current="page"><h5>My Option Screeners</h5></li>
            </ol>
        </div>
    </nav>

    <div class="container bg-white text-dark d-flex flex-wrap overflow-auto justify-content-center">
        <div class="row w-100">
            {% if iv_page_obj %}
            <div class="container">
                <div class="card">
                    <div class="card text-center">
                        <div class="card-body">
                            <p class="card-text">You have {{myimpliedlist_count}} option series in your dashboard.</p>
                            <a href="{% url "option_pricing:myseriesscreenerlistcbv" %}" class="btn btn-primary">IV Screeners</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-3 container bg-white text-dark">
                <div class="row">
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                        <tr>
                            <th><small><strong></strong></small></th>
                            <th><small><strong>Asset</strong></small></th>
                            <th><small><strong>Option Type</strong></small></th>
                            <th><small><strong>Expiration Date</strong></small></th>
                            <th><small><strong>Exercise Prices</strong></small></th>
                            <th><small><strong>Latest Trading</strong></small></th>
                        </tr>
                        {%csrf_token%}
                        {% for series in myimpliedlist %}
                            <tr id="{{iv.id}}">
                                <td><input type="checkbox" name="series_id[]" value="{{series.id}}" id="fav_option"></td>
                                <td><small>{{ series.get_asset_display}}</small></td>
                                <td><small>{{ series.get_optiontype_display}}</small></td>
                                <td><small>{{ series.expmonthdate|date:"SHORT_DATE_FORMAT" }}</small></td>
                                <td><small>{{ iv_strike_number|index:forloop.counter0 }}</small></td>
                                <td><small>{{ iv_latest_trad_date|index:forloop.counter0}}</small></td>
                            </tr>
                        {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row d-flex justify-content-start">
                    {% if request.user.is_authenticated %}
                        <button id="iv_del_btn" class="btn btn-sm btn-primary h-25 d-inline-block">Delete From My Screeners</button>
                    {% else %}
                        <a class="btn btn-sm btn-primary h-25 d-inline-block" href='{% url "accounts:login" %}' role="button">Add to My Screeners</a>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="col-md-12 d-flex justify-content-center">
                <div class="card">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-center">Welcome to My Option Screeners</h5>
                            <p class="card-text d-flex justify-content-center">Your option screeners list is empty. Add options to your dashboard to gain crucial insight at the products you need to maintain close monitoring.
                                This will significantly facilitate your trading decisions.
                            </p>   
                            <a href="{% url "option_pricing:myoptionscreenerlistcbv" %}" class="btn btn-primary">Options Screeners</a>                    
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        </div>
    </div>



<div class="row">
    {% for implied in myimpliedlist %}
    <div class="col-md-4">
        {{ implied.asset }}&nbsp;{{ implied.optiontype }}&nbsp;{{ implied.expmonthdate }}
        <a href="{% url 'option_pricing:impliedvolsmile' implied.asset implied.optiontype implied.expmonthdate.month implied.expmonthdate.year %}">{{ implied.asset }}&nbsp;{{ implied.optiontype }}&nbsp;{{ implied.expmonthdate }}</a>
    </div>
    {% endfor %}
</div>
<div class="row">

</div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function(){
        $('#iv_del_btn').click(function(){

                var id=[];
                var csrf=$('input[name=csrfmiddlewaretoken]').val();
                $(':checkbox:checked').each(function(i){
                    id[i]=$(this).val()
                })
                if(id.length===0){
                    alert("Please select at least one option screener to remove")
                }else{
                    console.log(id)
                    $.ajax({
                        url:'{% url "accounts:iv-screener-remove" %}',
                        method:"POST",
                        data:{
                            id,
                            csrfmiddlewaretoken:csrf
                        },
                        success:function(response){
                            for (var i=0; i < id.length; i++){
                                $('tr#'+id[i]+'').css('background-color', '#ccc');
                                $('tr#'+id[i]+'').fadeOut('slow');
                            }
                            alert("Options successfully removed from my screeners");
                        }
                    })
                }
                $( 'input[type="checkbox"]' ).prop('checked', false);
        })
    })
</script>

{% endblock %}