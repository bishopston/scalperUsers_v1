{%  extends "../base/base.html" %}

{% block content %}

{% load index %}

<div class="mt-2 container bg-white text-dark">
    <div class="container bg-light text-dark">
        <div class="row">
            <div class="col my-3">
                <h6><a href="{% url 'accounts:portfolio' %}">My Portfolios</a> / {{portfolio.name}}</h6>
            </div>
        </div>
    </div>
    <div class="container bg-white text-dark d-flex flex-wrap overflow-auto justify-content-start mt-2">
      <div class="row">
          <div class="col-md-12">
              <ul class="nav nav-pills">
                  <li class="nav-item">
                      <a href="#summary" class="nav-link active" role="tab" data-toggle="tab">Summary</a>
                  </li>
                  <li class="nav-item">
                      <a href="#valuation" class="nav-link" role="tab" data-toggle="tab">Payoff</a>
                  </li>
              </ul>

              <div class="my-1 tab-content justify-content-center">
                      <div role="tabpanel" class="tab-pane active" id="summary">
                        <div id="accordion">
                            <div class="card mt-4">
                              <div class="card-header bg-secondary" id="headingOne">
                                <h5 class="mb-0">
                                  <button class="btn btn-link text-light" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Options
                                  </button>
                                </h5>
                              </div>
                          
                              <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                                <div class="card-body">
                                  {% if error_message %}
                                  <center><p><strong class="text-danger">{{ error_message }}</strong></p></center>
                                  {% endif %}

                                  {% for error in portfolioOptionForm.errors %}
                                  <center><p><strong class="text-danger">Please select a valid {{ error }} value</strong></p></center>
                                  {% endfor %}     

                                  
                                    {% if options %}
                                      <div class="container bg-white text-dark">
                                        <div class="row">
                                          <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                              <tr>
                                                <th><small><strong></strong></small></th>
                                                <th><small><strong>Symbol</strong></small></th>
                                                <th><small><strong>Option Type</strong></small></th>
                                                <th><small><strong>Position</strong></small></th>
                                                <th><small><strong>Added On</strong></small></th>
                                                <th><small><strong>Latest Trading</strong></small></th>
                                                <th><small><strong>Expiration</strong></small></th>
                                                <th><small><strong>Contracts</strong></small></th>
                                                <th><small><strong>Unit Debit/Credit</strong></small></th>
                                                <th><small><strong>Latest Value</strong></small></th>
                                                <th><small><strong>Underlying Price</strong></small></th>
                                                <th><small><strong>Unit Exercise Profit/Loss</strong></small></th>
                                                <th><small><strong></strong></small></th>
                                              </tr>
                                              {%csrf_token%}
                                              {% for option in options %}
                                                <tr id="{{option.id}}">
                                                    <td><input type="checkbox" name="option_id[]" value="{{option.id}}" id="portfolio_option"></td>
                                                    <td><small>
                                                      {% if option.active_option %}
                                                        <a href="{% url 'option_pricing:option_screener_detail' option.optionsymbol.symbol %}">{{ option.optionsymbol.symbol }}</a>
                                                      {% else %}
                                                        <a href="{% url 'option_pricing:option_screener_detail' option.optionsymbol.symbol %}"><del>{{ option.optionsymbol.symbol }}</del></a>
                                                      {% endif %}
                                                    </small></td>
                                                    <td><small>{{option.optionsymbol.get_optiontype_display}}</small></td>
                                                    <td><small>{{option.position}}</small></td>  
                                                    <td><small>{{option.created_at|date:"SHORT_DATE_FORMAT"}}</small></td> 
                                                    <td><small>{{max_options_dates|index:forloop.counter0}}</small></td>
                                                    <td><small>{{option.optionsymbol.expmonthdate|date:"SHORT_DATE_FORMAT"}}</small></td>
                                                    <td><small>{{option.contracts}}</small></td>
                                                    <td><small>{{option.buysellprice}}</small></td> 
                                                    <td><small>{{options_clos_prices|index:forloop.counter0}}</small></td>  
                                                    <td><small>{{stock_prices|index:forloop.counter0}}</small></td>     
                                                    <td><small>
                                                      {% if profits|index:forloop.counter0 < 0 %}
                                                      <div class="change-negative"> 
                                                      {% else %} 
                                                      <div class="change-positive">
                                                      {% endif %}
                                                      {{ profits|index:forloop.counter0|floatformat:2 }}
                                                      </div>
                                                    </small></td> 
                                                    <td><a href="{% url 'accounts:portfolio-option-update' portfolio.id option.id %}"><i class="fa fa-pencil" aria-hidden="true"></i></a></td>
                                                </tr>

                                              {% endfor %}
                                            </table>
                                          </div>
                                        </div>
                                      </div>  
                                      
                                      <div class="d-flex justify-content-center my-1 ml-1">
                                        <button type="button" class="btn btn-outline-primary d-flex flex-wrap align-content-center" id="del_btn"><small>Delete Option</small></button>

                                        <div class="d-flex justify-content-center px-3">
                                          <button type="button" class="btn btn-primary d-flex flex-wrap align-content-center" data-toggle="modal" data-target="#optionAddModal">
                                              <small>Add Option</small> 
                                          </button>
                                        </div>
                                        <!-- Modal -->
                                        <div class="modal fade" id="optionAddModal" tabindex="-1" role="dialog" aria-labelledby="optionAddModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                <h5 class="modal-title" id="optionAddModalLabel">Add Option</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                                </div>
                                                <div class="modal-body">
                                                    <form method="POST" id="optionmodalform" action=".">
                                                        {% csrf_token %}                                
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-6 mb-0">
                                                            {{ portfolioOptionForm.asset }}
                                                          </div>
                                                          <div class="form-group col-md-6 mb-0">
                                                            {% for radio in portfolioOptionForm.option_type %}
                                                              {{ radio }}
                                                            {% endfor %} 
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-6 mb-0" aria-describedby="expDateHelpBlock">
                                                            {{ portfolioOptionForm.exp_month }}
                                                          </div>
                                                          <div class="form-group col-md-6 mb-0">
                                                            {{ portfolioOptionForm.exp_year}}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="expDateHelpBlock" class="form-text text-muted">
                                                              Please select an active option
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0" aria-describedby="strikeHelpBlock">
                                                            {{ portfolioOptionForm.strike }}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="strikeHelpBlock" class="form-text text-muted">
                                                              Please select either an integer or decimal number (use dot as a separator)
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0" aria-describedby="positionTypeHelpInline">
                                                            {% for radio in portfolioOptionForm.position_type %}
                                                              {{ radio }}
                                                            {% endfor %}
                                                            <small id="positionTypeHelpInline" class="text-muted ml-2">
                                                              Please select the type of position
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0">
                                                            {{ portfolioOptionForm.contracts }}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                              Please select an integer value
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0" aria-describedby="buySellPriceHelpBlock">
                                                            {{ portfolioOptionForm.buysellprice}}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                              Please select either an integer or decimal number (use dot as a separator)
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                        <button type="submit" class="btn btn-primary" name="option_button">Add to {{portfolio.name}}</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            </div>
                                        </div>

                                      </div>

                                    {% else %}
                                        <div class="col-md-12 d-flex justify-content-center">
                                            <div class="card border-0">
                                                <div class="card-body">
                                                    <p class="card-text d-flex justify-content-center">Your option list is empty. Add option symbols to your portfolio.</p>                       
                                                </div>
                                                <div class="row d-flex justify-content-center mb-3">
                                                  <button type="button" class="btn btn-primary d-flex flex-wrap align-content-center" data-toggle="modal" data-target="#optionAddModal">
                                                      <small>Add option</small> 
                                                  </button>
                                                  
                                                  <!-- Modal -->
                                                  <div class="modal fade" id="optionAddModal" tabindex="-1" role="dialog" aria-labelledby="optionAddModalLabel" aria-hidden="true">
                                                      <div class="modal-dialog" role="document">
                                                      <div class="modal-content">
                                                          <div class="modal-header">
                                                          <h5 class="modal-title" id="optionAddModalLabel">Add Option</h5>
                                                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                              <span aria-hidden="true">&times;</span>
                                                          </button>
                                                          </div>
                                                          <div class="modal-body">
                                                            <form method="POST" id="optionmodalform" action=".">
                                                              {% csrf_token %}                                
                                                              <div class="form-row mb-2">
                                                                <div class="form-group col-md-6 mb-0">
                                                                  {{ portfolioOptionForm.asset }}
                                                                </div>
                                                                <div class="form-group col-md-6 mb-0">
                                                                  {% for radio in portfolioOptionForm.option_type %}
                                                                    {{ radio }}
                                                                  {% endfor %} 
                                                                </div>
                                                              </div>
                                                              <div class="form-row mb-2">
                                                                <div class="form-group col-md-6 mb-0" aria-describedby="expDateHelpBlock">
                                                                  {{ portfolioOptionForm.exp_month }}
                                                                </div>
                                                                <div class="form-group col-md-6 mb-0">
                                                                  {{ portfolioOptionForm.exp_year}}
                                                                </div>
                                                                <div class="ml-2"> 
                                                                  <small id="expDateHelpBlock" class="form-text text-muted">
                                                                    Please select an active option
                                                                  </small>
                                                                </div>
                                                              </div>
                                                              <div class="form-row mb-2">
                                                                <div class="form-group col-md-12 mb-0" aria-describedby="strikeHelpBlock">
                                                                  {{ portfolioOptionForm.strike }}
                                                                </div>
                                                                <div class="ml-2"> 
                                                                  <small id="strikeHelpBlock" class="form-text text-muted">
                                                                    Please select either an integer or decimal number (use dot as a separator)
                                                                  </small>
                                                                </div>
                                                              </div>
                                                              <div class="form-row mb-2">
                                                                <div class="form-group col-md-12 mb-0" aria-describedby="positionTypeHelpInline">
                                                                  {% for radio in portfolioOptionForm.position_type %}
                                                                    {{ radio }}
                                                                  {% endfor %}
                                                                  <small id="positionTypeHelpInline" class="text-muted ml-2">
                                                                    Please select the type of position
                                                                  </small>
                                                                </div>
                                                              </div>
                                                              <div class="form-row mb-2">
                                                                <div class="form-group col-md-12 mb-0">
                                                                  {{ portfolioOptionForm.contracts }}
                                                                </div>
                                                                <div class="ml-2"> 
                                                                  <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                                    Please select an integer value
                                                                  </small>
                                                                </div>
                                                              </div>
                                                              <div class="form-row mb-2">
                                                                <div class="form-group col-md-12 mb-0" aria-describedby="buySellPriceHelpBlock">
                                                                  {{ portfolioOptionForm.buysellprice}}
                                                                </div>
                                                                <div class="ml-2"> 
                                                                  <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                                    Please select either an integer or decimal number (use dot as a separator)
                                                                  </small>
                                                                </div>
                                                              </div>
                                                              <div class="modal-footer">
                                                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                              <button type="submit" class="btn btn-primary" name="option_button">Add to {{portfolio.name}}</button>
                                                              </div>
                                                          </form>
                                                          </div>
                                                      </div>
                                                      </div>
                                                  </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                              </div>
                            </div>
                            <div class="card">
                              <div class="card-header bg-secondary" id="headingTwo">
                                <h5 class="mb-0">
                                  <button class="btn btn-link collapsed text-light" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Futures
                                  </button>
                                </h5>
                              </div>
                              <div id="collapseTwo" class="collapse show" aria-labelledby="headingTwo" data-parent="#accordion">
                                <div class="card-body">
                                    {% if error_future_message %}
                                    <center><p><strong class="text-danger">{{ error_future_message }}</strong></p></center>
                                    {% endif %}

                                    {% for error in portfolioFutureForm.errors %}
                                    <center><p><strong class="text-danger">Please select a valid {{ error }} value</strong></p></center>
                                    {% endfor %}                

                                    {% if futures %}
                                      <div class="container bg-white text-dark">
                                        <div class="row">
                                          <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                              <tr>
                                                <th><small><strong></strong></small></th>
                                                <th><small><strong>Symbol</strong></small></th>
                                                <th><small><strong>Position</strong></small></th>
                                                <th><small><strong>Added On</strong></small></th>
                                                <th><small><strong>Latest Trading</strong></small></th>
                                                <th><small><strong>Expiration</strong></small></th>
                                                <th><small><strong>Contracts</strong></small></th>
                                                <th><small><strong>Unit Debit/Credit</strong></small></th>
                                                <th><small><strong>Latest Value</strong></small></th>
                                                <th><small><strong>Underlying Price</strong></small></th>
                                                <th><small><strong>Unit Exercise Profit/Loss</strong></small></th>
                                                <th><small><strong></strong></small></th>
                                              </tr>
                                              {%csrf_token%}
                                              {% for future in futures %}
                                                <tr id="{{future.id}}">
                                                    <td><input type="checkbox" name="future_id[]" value="{{future.id}}" id="portfolio_future"></td>
                                                    <td><small>
                                                      {% if future.active_future %}
                                                        <a href="{% url 'option_pricing:future_screener_detail' future.futuresymbol.symbol %}">{{ future.futuresymbol.symbol }}</a>
                                                      {% else %}
                                                        <a href="{% url 'option_pricing:future_screener_detail' future.futuresymbol.symbol %}"><del>{{ future.futuresymbol.symbol }}</del></a>
                                                      {% endif %}
                                                    </small></td>
                                                    <td><small>{{future.position}}</small></td>  
                                                    <td><small>{{future.created_at|date:"SHORT_DATE_FORMAT"}}</small></td> 
                                                    <td><small>{{max_futures_dates|index:forloop.counter0}}</small></td>
                                                    <td><small>{{future.futuresymbol.expmonthdate|date:"SHORT_DATE_FORMAT"}}</small></td>
                                                    <td><small>{{future.contracts}}</small></td>
                                                    <td><small>{{future.buysellprice}}</small></td> 
                                                    <td><small>{{futures_clos_prices|index:forloop.counter0}}</small></td>  
                                                    <td><small>{{futures_stock_prices|index:forloop.counter0}}</small></td>     
                                                    <td><small>
                                                      {% if futures_profits|index:forloop.counter0 < 0 %}
                                                      <div class="change-negative"> 
                                                      {% else %} 
                                                      <div class="change-positive">
                                                      {% endif %}
                                                      {{ futures_profits|index:forloop.counter0|floatformat:2 }}
                                                      </div>
                                                    </small></td> 
                                                    <td><a href="{% url 'accounts:portfolio-future-update' portfolio.id future.id %}"><i class="fa fa-pencil" aria-hidden="true"></i></a></td>
                                                </tr>

                                              {% endfor %}
                                            </table>
                                          </div>
                                        </div>
                                      </div>  
                                      
                                      <div class="d-flex justify-content-center my-1 ml-1">
                                        <button type="button" class="btn btn-outline-primary d-flex flex-wrap align-content-center" id="del_fut_btn"><small>Delete Future</small></button>

                                        <div class="d-flex justify-content-center px-3">
                                          <button type="button" class="btn btn-primary d-flex flex-wrap align-content-center" data-toggle="modal" data-target="#futureAddModal">
                                              <small>Add Future</small> 
                                          </button>
                                        </div>
                                        <!-- Modal -->
                                        <div class="modal fade" id="futureAddModal" tabindex="-1" role="dialog" aria-labelledby="futureAddModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                <h5 class="modal-title" id="futureAddModalLabel">Add Future</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                                </div>
                                                <div class="modal-body">
                                                    <form method="POST" id="futuremodalform" action='{% url "accounts:portfolio-future-detail" portfolio.id %}'>
                                                        {% csrf_token %}                                
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-6 mb-0">
                                                            {{ portfolioFutureForm.asset }}
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-6 mb-0" aria-describedby="expDateHelpBlock">
                                                            {{ portfolioFutureForm.exp_month }}
                                                          </div>
                                                          <div class="form-group col-md-6 mb-0">
                                                            {{ portfolioFutureForm.exp_year}}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="expDateHelpBlock" class="form-text text-muted">
                                                              Please select an active future
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0" aria-describedby="positionTypeHelpInline">
                                                            {% for radio in portfolioFutureForm.position_type %}
                                                              {{ radio }}
                                                            {% endfor %}
                                                            <small id="positionTypeHelpInline" class="text-muted ml-2">
                                                              Please select the type of position
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0">
                                                            {{ portfolioFutureForm.contracts }}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                              Please select an integer value
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0" aria-describedby="buySellPriceHelpBlock">
                                                            {{ portfolioFutureForm.buysellprice}}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                              Please select either an integer or decimal number (use dot as a separator)
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                        <button type="submit" class="btn btn-primary" name="future_button">Add to {{portfolio.name}}</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            </div>
                                        </div>

                                      </div>

                                    {% else %}
                                        <div class="col-md-12 d-flex justify-content-center">
                                            <div class="card border-0">
                                                <div class="card-body">
                                                    <p class="card-text d-flex justify-content-center">Your future list is empty. Add future symbols to your portfolio.</p>                       
                                                </div>
                                                <div class="row d-flex justify-content-center mb-3">
                                                  <button type="button" class="btn btn-primary d-flex flex-wrap align-content-center" data-toggle="modal" data-target="#futureAddModal">
                                                      <small>Add Future</small> 
                                                  </button>
                                                  
                                                  <!-- Modal -->
                                    <div class="modal fade" id="futureAddModal" tabindex="-1" role="dialog" aria-labelledby="futureAddModalLabel" aria-hidden="true">
                                      <div class="modal-dialog" role="document">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                        <h5 class="modal-title" id="futureAddModalLabel">Add Future</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                        </div>
                                        <div class="modal-body">
                                          <form method="POST" id="futuremodalform" action='{% url "accounts:portfolio-future-detail" portfolio.id %}'>
                                            {% csrf_token %}                                
                                            <div class="form-row mb-2">
                                              <div class="form-group col-md-6 mb-0">
                                              {{ portfolioFutureForm.asset }}
                                              </div>
                                            </div>
                                            <div class="form-row mb-2">
                                              <div class="form-group col-md-6 mb-0" aria-describedby="expDateHelpBlock">
                                              {{ portfolioFutureForm.exp_month }}
                                              </div>
                                              <div class="form-group col-md-6 mb-0">
                                              {{ portfolioFutureForm.exp_year}}
                                              </div>
                                              <div class="ml-2"> 
                                              <small id="expDateHelpBlock" class="form-text text-muted">
                                                Please select an active future
                                              </small>
                                              </div>
                                            </div>
                                            <div class="form-row mb-2">
                                              <div class="form-group col-md-12 mb-0" aria-describedby="positionTypeHelpInline">
                                              {% for radio in portfolioFutureForm.position_type %}
                                                {{ radio }}
                                              {% endfor %}
                                              <small id="positionTypeHelpInline" class="text-muted ml-2">
                                                Please select the type of position
                                              </small>
                                              </div>
                                            </div>
                                            <div class="form-row mb-2">
                                              <div class="form-group col-md-12 mb-0">
                                              {{ portfolioFutureForm.contracts }}
                                              </div>
                                              <div class="ml-2"> 
                                              <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                Please select an integer value
                                              </small>
                                              </div>
                                            </div>
                                            <div class="form-row mb-2">
                                              <div class="form-group col-md-12 mb-0" aria-describedby="buySellPriceHelpBlock">
                                              {{ portfolioFutureForm.buysellprice}}
                                              </div>
                                              <div class="ml-2"> 
                                              <small id="buySellPriceHelpBlock" class="form-text text-muted">
                                                Please select either an integer or decimal number (use dot as a separator)
                                              </small>
                                              </div>
                                            </div>
                                            <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-primary" name="future_button">Add to {{portfolio.name}}</button>
                                            </div>
                                          </form>
                                        </div>
                                      </div>
                                      </div>
                                    </div>
                                  </div>
                              </div>
                          </div>
                                    {% endif %}
                                </div>
                              </div>
                            </div>
                            <div class="card">
                              <div class="card-header bg-secondary" id="headingThree">
                                <h5 class="mb-0">
                                  <button class="btn btn-link collapsed text-light" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    Stocks
                                  </button>
                                </h5>
                              </div>
                              <div id="collapseThree" class="collapse show" aria-labelledby="headingThree" data-parent="#accordion">
                                <div class="card-body">
                                    {% if error_stock_message %}
                                    <center><p><strong class="text-danger">{{ error_stock_message }}</strong></p></center>
                                    {% endif %}

                                    {% for error in portfolioStockForm.errors %}
                                    <center><p><strong class="text-danger">Please select a valid {{ error }} value</strong></p></center>
                                    {% endfor %}                

                                    {% if stocks %}
                                      <div class="container bg-white text-dark">
                                        <div class="row">
                                          <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                              <tr>
                                                <th><small><strong></strong></small></th>
                                                <th><small><strong>Asset</strong></small></th>
                                                <th><small><strong>Added On</strong></small></th>
                                                <th><small><strong>Latest Trading</strong></small></th>
                                                <th><small><strong>Quantity</strong></small></th>
                                                <th><small><strong>Unit Debit</strong></small></th>
                                                <th><small><strong>Latest Price</strong></small></th>
                                                <th><small><strong>Unit Exercise Profit/Loss</strong></small></th>
                                                <th><small><strong></strong></small></th>
                                              </tr>
                                              {%csrf_token%}
                                              {% for stock in stocks %}
                                                <tr id="{{stock.id}}">
                                                    <td><input type="checkbox" name="stock_id[]" value="{{stock.id}}" id="portfolio_stock"></td>
                                                    <td><small>{{ stock.stocksymbol.get_asset_display }}</small></td>                                 
                                                    <td><small>{{stock.created_at|date:"SHORT_DATE_FORMAT"}}</small></td> 
                                                    <td><small>{{max_stocks_dates|index:forloop.counter0}}</small></td>
                                                    <td><small>{{stock.quantity}}</small></td>
                                                    <td><small>{{stock.buyprice}}</small></td> 
                                                    <td><small>{{stock_stock_prices|index:forloop.counter0}}</small></td>     
                                                    <td><small>
                                                      {% if stocks_profits|index:forloop.counter0 < 0 %}
                                                      <div class="change-negative"> 
                                                      {% else %} 
                                                      <div class="change-positive">
                                                      {% endif %}
                                                      {{ stocks_profits|index:forloop.counter0|floatformat:2 }}
                                                      </div>
                                                    </small></td> 
                                                    <td><a href="{% url 'accounts:portfolio-stock-update' portfolio.id stock.id %}"><i class="fa fa-pencil" aria-hidden="true"></i></a></td>
                                                </tr>

                                              {% endfor %}
                                            </table>
                                          </div>
                                        </div>
                                      </div>  
                                      
                                      <div class="d-flex justify-content-center my-1 ml-1">
                                        <button type="button" class="btn btn-outline-primary d-flex flex-wrap align-content-center" id="del_stock_btn"><small>Delete Stock</small></button>

                                        <div class="d-flex justify-content-center px-3">
                                          <button type="button" class="btn btn-primary d-flex flex-wrap align-content-center" data-toggle="modal" data-target="#stockAddModal">
                                              <small>Add Stock</small> 
                                          </button>
                                        </div>
                                        <!-- Modal -->
                                        <div class="modal fade" id="stockAddModal" tabindex="-1" role="dialog" aria-labelledby="stockAddModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                <h5 class="modal-title" id="stockAddModalLabel">Add Stock</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                                </div>
                                                <div class="modal-body">
                                                    <form method="POST" id="stockmodalform" action='{% url "accounts:portfolio-stock-detail" portfolio.id %}'>
                                                        {% csrf_token %}                                
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0">
                                                            {{ portfolioStockForm.asset }}
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0">
                                                            {{ portfolioStockForm.quantity }}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="quantityHelpBlock" class="form-text text-muted">
                                                              Please select an integer value
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0" aria-describedby="buyPriceHelpBlock">
                                                            {{ portfolioStockForm.buyprice}}
                                                          </div>
                                                          <div class="ml-2"> 
                                                            <small id="buyPriceHelpBlock" class="form-text text-muted">
                                                              Please select either an integer or decimal number (use dot as a separator)
                                                            </small>
                                                          </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                        <button type="submit" class="btn btn-primary" name="stock_button">Add to {{portfolio.name}}</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            </div>
                                        </div>

                                      </div>

                                    {% else %}
                                        <div class="col-md-12 d-flex justify-content-center">
                                            <div class="card border-0">
                                                <div class="card-body">
                                                    <p class="card-text d-flex justify-content-center">Your stock list is empty. Add stocks to your portfolio.</p>                       
                                                </div>
                                                <div class="row d-flex justify-content-center mb-3">
                                                  <button type="button" class="btn btn-primary d-flex flex-wrap align-content-center" data-toggle="modal" data-target="#stockAddModal">
                                                      <small>Add Stock</small> 
                                                  </button>
                                                  
                                                  <!-- Modal -->
                                                <div class="modal fade" id="stockAddModal" tabindex="-1" role="dialog" aria-labelledby="stockAddModalLabel" aria-hidden="true">
                                                  <div class="modal-dialog" role="document">
                                                  <div class="modal-content">
                                                    <div class="modal-header">
                                                    <h5 class="modal-title" id="stockAddModalLabel">Add Stock</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                      <span aria-hidden="true">&times;</span>
                                                    </button>
                                                    </div>
                                                    <div class="modal-body">
                                                      <form method="POST" id="stockmodalform" action='{% url "accounts:portfolio-stock-detail" portfolio.id %}'>
                                                        {% csrf_token %}                                
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0">
                                                          {{ portfolioStockForm.asset }}
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0">
                                                          {{ portfolioStockForm.quantity }}
                                                          </div>
                                                          <div class="ml-2"> 
                                                          <small id="quantityHelpBlock" class="form-text text-muted">
                                                            Please select an integer value
                                                          </small>
                                                          </div>
                                                        </div>
                                                        <div class="form-row mb-2">
                                                          <div class="form-group col-md-12 mb-0" aria-describedby="buyPriceHelpBlock">
                                                          {{ portfolioStockForm.buyprice}}
                                                          </div>
                                                          <div class="ml-2"> 
                                                          <small id="buyPriceHelpBlock" class="form-text text-muted">
                                                            Please select either an integer or decimal number (use dot as a separator)
                                                          </small>
                                                          </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                        <button type="submit" class="btn btn-primary" name="stock_button">Add to {{portfolio.name}}</button>
                                                        </div>
                                                      </form>
                                                    </div>
                                                  </div>
                                                  </div>
                                                </div>
                                  </div>
                              </div>
                          </div>
                                    {% endif %}
                                </div>
                              </div>
                            </div>
                        </div>
                      </div>
                      <div role="tabpanel" class="tab-pane" id="valuation">
                        <div class="row mt-2">
                          <div class="container">
                              <div class="table-responsive mt-2">
                                <table class="table table-striped table-sm mt-2">
                                  <thead class="thead-dark">
                                    <tr>
                                      <th scope="col">Active Options</th>
                                      <th scope="col">Active Futures</th>
                                      <th scope="col">Stocks</th>
                                      <th scope="col">Total Valuation</th>
                                      <th scope="col">Total Payoff</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td class="d-flex justify-content-center">{{active_options_count}}</td>
                                      <td>{{active_futures_count}}</td>
                                      <td>mitsos</td>
                                      <td>{{total_portfolio_valuation}}</td>
                                      <td>{{total_portfolio_payoff}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                          </div>
                        </div>
                      </div>
              </div>
          </div>
      </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function(){
        $('#del_btn').click(function(){

                var id=[];
                var portfolio_id="{{portfolio.id}}";
                var csrf=$('input[name=csrfmiddlewaretoken]').val();
                $(':checkbox:checked').each(function(i){
                    id[i]=$(this).val()
                })
                if(id.length===0){
                    alert("Please select at least one option to delete")
                }else{
                    console.log(id)
                    console.log(portfolio_id)
                    $.ajax({
                        url:'{% url "accounts:portfolio-option-delete" %}',
                        method:"POST",
                        data:{
                            id,
                            portfolio_id,
                            csrfmiddlewaretoken:csrf
                        },
                        success:function(response){
                            for (var i=0; i < id.length; i++){
                                $('tr#'+id[i]+'').css('background-color', '#ccc');
                                $('tr#'+id[i]+'').fadeOut('slow');
                            }
                        }
                    })
                }
                $( 'input[type="checkbox"]' ).prop('checked', false);
        })
    })
</script>

<script>
  $(document).ready(function(){
      $('#del_fut_btn').click(function(){

              var id=[];
              var portfolio_id="{{portfolio.id}}";
              var csrf=$('input[name=csrfmiddlewaretoken]').val();
              $(':checkbox:checked').each(function(i){
                  id[i]=$(this).val()
              })
              if(id.length===0){
                  alert("Please select at least one future to delete")
              }else{
                  console.log(id)
                  console.log(portfolio_id)
                  $.ajax({
                      url:'{% url "accounts:portfolio-future-delete" %}',
                      method:"POST",
                      data:{
                          id,
                          portfolio_id,
                          csrfmiddlewaretoken:csrf
                      },
                      success:function(response){
                          for (var i=0; i < id.length; i++){
                              $('tr#'+id[i]+'').css('background-color', '#ccc');
                              $('tr#'+id[i]+'').fadeOut('slow');
                          }
                      }
                  })
              }
              $( 'input[type="checkbox"]' ).prop('checked', false);
      })
  })
</script>

<script>
  $(document).ready(function(){
      $('#del_stock_btn').click(function(){

              var id=[];
              var portfolio_id="{{portfolio.id}}";
              var csrf=$('input[name=csrfmiddlewaretoken]').val();
              $(':checkbox:checked').each(function(i){
                  id[i]=$(this).val()
              })
              if(id.length===0){
                  alert("Please select at least one stock to delete")
              }else{
                  console.log(id)
                  console.log(portfolio_id)
                  $.ajax({
                      url:'{% url "accounts:portfolio-stock-delete" %}',
                      method:"POST",
                      data:{
                          id,
                          portfolio_id,
                          csrfmiddlewaretoken:csrf
                      },
                      success:function(response){
                          for (var i=0; i < id.length; i++){
                              $('tr#'+id[i]+'').css('background-color', '#ccc');
                              $('tr#'+id[i]+'').fadeOut('slow');
                          }
                      }
                  })
              }
              $( 'input[type="checkbox"]' ).prop('checked', false);
      })
  })
</script>

{% endblock %}